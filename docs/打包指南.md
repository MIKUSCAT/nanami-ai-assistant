# ğŸ“¦ ä¸ƒæµ· AI åŠ©æ‰‹ - æ‰“åŒ…æŒ‡å—

å®Œæ•´çš„ Electron åº”ç”¨æ‰“åŒ…æ•™ç¨‹ï¼Œé€‚åˆå°ç™½

---

## ğŸ“‹ æ‰“åŒ…å‰å‡†å¤‡

### 1ï¸âƒ£ ç¡®ä¿é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œ

```bash
cd "E:\å¤‡ä»½-2\nanami-ai-assistant\frontend"
npm run electron:dev
```

ç¡®è®¤åº”ç”¨èƒ½æ­£å¸¸æ‰“å¼€ï¼Œæ²¡æœ‰æŠ¥é”™ã€‚

### 2ï¸âƒ£ æ£€æŸ¥ä¾èµ–

ç¡®ä¿ `package.json` ä¸­æœ‰ä»¥ä¸‹ä¾èµ–ï¼š

```json
{
  "devDependencies": {
    "electron": "^28.0.0",
    "electron-builder": "^24.9.1",
    "vite": "^5.0.0"
  }
}
```

---

## ğŸ”§ é…ç½®æ‰“åŒ…é€‰é¡¹

### ç¼–è¾‘ `package.json`

åœ¨ `package.json` ä¸­æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```json
{
  "name": "nanami-ai-assistant",
  "version": "0.1.0",
  "description": "ä¸ƒæµ· AI åŠ©æ‰‹ - åŸºäº SubAgent æ¶æ„çš„æ™ºèƒ½æ¡Œé¢åŠ©æ‰‹",
  "author": "MIKUSCAT",
  "license": "MIT",
  "main": "dist-electron/main.js",

  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "electron:dev": "concurrently \"vite\" \"wait-on tcp:5173 && electron .\"",
    "electron:build": "npm run build && electron-builder"
  },

  "build": {
    "appId": "com.mikuscat.nanami-assistant",
    "productName": "ä¸ƒæµ·AIåŠ©æ‰‹",
    "copyright": "Copyright Â© 2025 MIKUSCAT",
    "directories": {
      "output": "release",
      "buildResources": "build"
    },
    "files": [
      "dist/**/*",
      "dist-electron/**/*",
      "package.json"
    ],
    "win": {
      "target": [
        {
          "target": "nsis",
          "arch": ["x64"]
        },
        {
          "target": "portable",
          "arch": ["x64"]
        }
      ],
      "icon": "public/icon.ico",
      "artifactName": "${productName}-${version}-Setup.${ext}"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true,
      "perMachine": true,
      "deleteAppDataOnUninstall": false,
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true,
      "shortcutName": "ä¸ƒæµ·AIåŠ©æ‰‹"
    },
    "portable": {
      "artifactName": "${productName}-${version}-Portable.${ext}"
    },
    "mac": {
      "target": ["dmg"],
      "icon": "public/icon.icns",
      "category": "public.app-category.productivity"
    },
    "linux": {
      "target": ["AppImage", "deb"],
      "icon": "public/icon.png",
      "category": "Utility"
    }
  }
}
```

---

## ğŸ¨ å‡†å¤‡å›¾æ ‡æ–‡ä»¶

### Windows å›¾æ ‡ï¼ˆicon.icoï¼‰

1. **å‡†å¤‡å›¾ç‰‡**ï¼šPNG æ ¼å¼ï¼Œå»ºè®® 512x512 åƒç´ 
2. **è½¬æ¢ä¸º .ico**ï¼š
   - åœ¨çº¿å·¥å…·ï¼šhttps://www.icoconverter.com/
   - æˆ–ä½¿ç”¨ Photoshop/GIMP
3. **ä¿å­˜ä½ç½®**ï¼š`frontend/public/icon.ico`

### macOS å›¾æ ‡ï¼ˆicon.icnsï¼‰

ä½¿ç”¨ `png2icns` å·¥å…·ï¼š
```bash
brew install libicns
png2icns icon.icns icon.png
```

### Linux å›¾æ ‡ï¼ˆicon.pngï¼‰

ç›´æ¥ä½¿ç”¨ 512x512 çš„ PNG æ–‡ä»¶å³å¯ã€‚

---

## ğŸš€ å¼€å§‹æ‰“åŒ…

### Windows å¹³å°

**æ­¥éª¤ 1ï¼šæ„å»ºå‰ç«¯**

```bash
cd "E:\å¤‡ä»½-2\nanami-ai-assistant\frontend"
npm run build
```

è¿™ä¼šç”Ÿæˆï¼š
- `dist/` - React æ„å»ºäº§ç‰©
- `dist-electron/` - Electron ä¸»è¿›ç¨‹

**æ­¥éª¤ 2ï¼šæ‰“åŒ…åº”ç”¨**

```bash
npm run electron:build
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ electron-builderï¼š

```bash
npx electron-builder --win --x64
```

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹äº§ç‰©**

æ‰“åŒ…å®Œæˆåï¼Œåœ¨ `release/` ç›®å½•ä¸‹ä¼šæœ‰ï¼š

```
release/
â”œâ”€â”€ ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Setup.exe        # å®‰è£…åŒ…ï¼ˆæ¨èåˆ†å‘ï¼‰
â”œâ”€â”€ ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Portable.exe     # ä¾¿æºç‰ˆï¼ˆå…å®‰è£…ï¼‰
â””â”€â”€ win-unpacked/                      # è§£å‹ç‰ˆï¼ˆç”¨äºæµ‹è¯•ï¼‰
    â””â”€â”€ ä¸ƒæµ·AIåŠ©æ‰‹.exe
```

---

## ğŸ“¦ æ‰“åŒ…é€‰é¡¹è¯¦è§£

### NSIS å®‰è£…åŒ…ï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹**ï¼š
- âœ… ä¸“ä¸šçš„å®‰è£…å‘å¯¼
- âœ… å¯é€‰å®‰è£…è·¯å¾„
- âœ… åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
- âœ… æ·»åŠ åˆ°å¼€å§‹èœå•
- âœ… æ”¯æŒå¸è½½ç¨‹åº

**é…ç½®**ï¼š
```json
"nsis": {
  "oneClick": false,                           // æ˜¯å¦ä¸€é”®å®‰è£…
  "allowToChangeInstallationDirectory": true,  // å…è®¸é€‰æ‹©å®‰è£…è·¯å¾„
  "perMachine": true,                          // ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£…
  "createDesktopShortcut": true,               // åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
  "createStartMenuShortcut": true              // åˆ›å»ºå¼€å§‹èœå•å¿«æ·æ–¹å¼
}
```

### Portable ä¾¿æºç‰ˆ

**ç‰¹ç‚¹**ï¼š
- âœ… æ— éœ€å®‰è£…ï¼ŒåŒå‡»å³ç”¨
- âœ… å¯æ”¾åœ¨Uç›˜ä½¿ç”¨
- âœ… ä¸å†™æ³¨å†Œè¡¨
- âœ… é€‚åˆä¸´æ—¶ä½¿ç”¨

**ä½¿ç”¨æ–¹å¼**ï¼š
1. ä¸‹è½½ `ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Portable.exe`
2. åŒå‡»è¿è¡Œå³å¯

---

## ğŸ” æ‰“åŒ…å¤±è´¥æ’æŸ¥

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ° icon.ico

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Application icon is not set
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿å›¾æ ‡æ–‡ä»¶å­˜åœ¨
ls public/icon.ico

# å¦‚æœä¸å­˜åœ¨ï¼Œå‡†å¤‡ä¸€ä¸ª 512x512 çš„å›¾æ ‡
# è®¿é—® https://www.icoconverter.com/ è½¬æ¢
```

### é—®é¢˜ 2ï¼šæ‰“åŒ…è¿‡ç¨‹ä¸­æ–­

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Cannot read properties of undefined (reading 'update')
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…é™¤ç¼“å­˜
rm -rf node_modules dist dist-electron release
npm install
npm run electron:build
```

### é—®é¢˜ 3ï¼šæ‰“åŒ…åæ— æ³•è¿è¡Œ

**åŸå› **ï¼šåç«¯ API åœ°å€ç¡¬ç¼–ç ä¸º `localhost`

**è§£å†³æ–¹æ¡ˆ**ï¼š

ç¼–è¾‘ `src/config.ts`ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```typescript
export const API_BASE_URL =
  import.meta.env.VITE_API_BASE_URL ||
  localStorage.getItem('apiBaseUrl') ||
  'http://localhost:7878'
```

åœ¨è®¾ç½®é¢æ¿æ·»åŠ  API åœ°å€é…ç½®åŠŸèƒ½ï¼Œè®©ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰åç«¯åœ°å€ã€‚

---

## ğŸ¯ é«˜çº§é…ç½®

### è‡ªåŠ¨æ›´æ–°

å®‰è£… `electron-updater`ï¼š

```bash
npm install electron-updater
```

åœ¨ `package.json` ä¸­æ·»åŠ ï¼š

```json
"build": {
  "publish": {
    "provider": "github",
    "owner": "MIKUSCAT",
    "repo": "nanami-ai-assistant"
  }
}
```

åœ¨ä¸»è¿›ç¨‹ä¸­å¯ç”¨è‡ªåŠ¨æ›´æ–°ï¼š

```typescript
import { autoUpdater } from 'electron-updater'

app.on('ready', () => {
  autoUpdater.checkForUpdatesAndNotify()
})
```

### ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰

**Windows ä»£ç ç­¾å**ï¼š

éœ€è¦è´­ä¹°ä»£ç ç­¾åè¯ä¹¦ï¼Œç„¶åé…ç½®ï¼š

```json
"win": {
  "certificateFile": "path/to/cert.pfx",
  "certificatePassword": "your_password"
}
```

**macOS ä»£ç ç­¾å**ï¼š

éœ€è¦ Apple Developer è´¦å·ï¼Œç„¶åé…ç½®ï¼š

```json
"mac": {
  "identity": "Developer ID Application: Your Name (XXXXXXXXXX)"
}
```

---

## ğŸ“Š æ‰“åŒ…äº§ç‰©å¯¹æ¯”

| ç±»å‹ | æ–‡ä»¶å¤§å° | å®‰è£…æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| **NSIS å®‰è£…åŒ…** | ~80MB | éœ€è¦å®‰è£… | é•¿æœŸä½¿ç”¨ï¼Œæ¨èåˆ†å‘ |
| **Portable ä¾¿æºç‰ˆ** | ~120MB | å…å®‰è£… | ä¸´æ—¶ä½¿ç”¨ï¼Œä¾¿æºç§»åŠ¨ |
| **win-unpacked** | ~150MB | è§£å‹å³ç”¨ | å¼€å‘æµ‹è¯• |

---

## ğŸ‰ å®Œæ•´æ‰“åŒ…æµç¨‹ï¼ˆWindowsï¼‰

### ä¸€é”®æ‰“åŒ…è„šæœ¬

åˆ›å»º `build.bat`ï¼š

```bat
@echo off
echo ==========================================
echo   ä¸ƒæµ· AI åŠ©æ‰‹ - Windows æ‰“åŒ…è„šæœ¬
echo ==========================================
echo.

echo [1/4] æ¸…ç†æ—§æ–‡ä»¶...
rmdir /s /q dist
rmdir /s /q dist-electron
rmdir /s /q release

echo [2/4] å®‰è£…ä¾èµ–...
call npm install

echo [3/4] æ„å»ºå‰ç«¯...
call npm run build

echo [4/4] æ‰“åŒ…åº”ç”¨...
call npx electron-builder --win --x64

echo.
echo ==========================================
echo   æ‰“åŒ…å®Œæˆï¼
echo   å®‰è£…åŒ…ä½ç½®: release\ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Setup.exe
echo   ä¾¿æºç‰ˆä½ç½®: release\ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Portable.exe
echo ==========================================
pause
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
# åŒå‡» build.bat å³å¯è‡ªåŠ¨æ‰“åŒ…
```

---

## ğŸŒ å¤šå¹³å°æ‰“åŒ…

### åœ¨ macOS ä¸Šæ‰“åŒ…

```bash
npm run electron:build -- --mac
```

è¾“å‡ºï¼š
- `release/ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0.dmg` - macOS å®‰è£…åŒ…
- `release/mac/ä¸ƒæµ·AIåŠ©æ‰‹.app` - macOS åº”ç”¨

### åœ¨ Linux ä¸Šæ‰“åŒ…

```bash
npm run electron:build -- --linux
```

è¾“å‡ºï¼š
- `release/ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0.AppImage` - Linux AppImage
- `release/ä¸ƒæµ·AIåŠ©æ‰‹_0.1.0_amd64.deb` - Debian å®‰è£…åŒ…

### è·¨å¹³å°æ‰“åŒ…ï¼ˆä¸æ¨èï¼‰

è™½ç„¶ electron-builder æ”¯æŒè·¨å¹³å°æ‰“åŒ…ï¼Œä½†ä¸æ¨èï¼š

```bash
# åœ¨ Windows ä¸Šæ‰“åŒ… macOSï¼ˆéœ€è¦é¢å¤–é…ç½®ï¼‰
npm run electron:build -- --mac --win
```

**å»ºè®®**ï¼šåœ¨å¯¹åº”å¹³å°ä¸Šæ‰“åŒ…ï¼Œç¡®ä¿å…¼å®¹æ€§ã€‚

---

## ğŸ“ æ‰“åŒ…æ£€æŸ¥æ¸…å•

æ‰“åŒ…å‰ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] å›¾æ ‡æ–‡ä»¶å‡†å¤‡å®Œæ¯•ï¼ˆicon.icoï¼‰
- [ ] package.json é…ç½®æ­£ç¡®
- [ ] åº”ç”¨èƒ½æ­£å¸¸è¿è¡Œï¼ˆnpm run electron:devï¼‰
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] å·²æµ‹è¯•æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- [ ] åç«¯ API åœ°å€å¯é…ç½®
- [ ] README.md å·²æ›´æ–°

---

## ğŸš€ å‘å¸ƒåˆ° GitHub Releases

### 1. åˆ›å»º Release

```bash
# æ‰“æ ‡ç­¾
git tag v0.1.0
git push origin v0.1.0
```

### 2. åœ¨ GitHub ä¸Šåˆ›å»º Release

1. è®¿é—®ä»“åº“é¡µé¢
2. ç‚¹å‡» "Releases" â†’ "Create a new release"
3. é€‰æ‹©æ ‡ç­¾ `v0.1.0`
4. ä¸Šä¼ æ‰“åŒ…æ–‡ä»¶ï¼š
   - `ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Setup.exe`
   - `ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Portable.exe`
5. å¡«å†™æ›´æ–°è¯´æ˜
6. å‘å¸ƒ

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### å‡å°åŒ…ä½“ç§¯

1. **ç§»é™¤å¼€å‘ä¾èµ–**ï¼š
```bash
npm prune --production
```

2. **å¯ç”¨å‹ç¼©**ï¼š
```json
"build": {
  "compression": "maximum"
}
```

3. **æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶**ï¼š
```json
"build": {
  "files": [
    "!**/*.map",
    "!**/*.ts",
    "!**/node_modules/**"
  ]
}
```

### åŠ å¿«æ‰“åŒ…é€Ÿåº¦

1. **ä½¿ç”¨æœ¬åœ°ç¼“å­˜**ï¼š
```bash
export ELECTRON_MIRROR=https://npmmirror.com/mirrors/electron/
```

2. **å¹¶è¡Œæ‰“åŒ…**ï¼š
```bash
electron-builder --win --x64 --parallel
```

---

## ğŸ“ æ€»ç»“

æ‰“åŒ… Electron åº”ç”¨çš„å®Œæ•´æµç¨‹ï¼š

```bash
# 1. å‡†å¤‡å›¾æ ‡
# 2. é…ç½® package.json
# 3. æ„å»ºå‰ç«¯
npm run build

# 4. æ‰“åŒ…åº”ç”¨
npm run electron:build

# 5. æµ‹è¯•å®‰è£…åŒ…
.\release\ä¸ƒæµ·AIåŠ©æ‰‹-0.1.0-Setup.exe

# 6. å‘å¸ƒåˆ° GitHub
```

**æ¨èåˆ†å‘æ–¹å¼**ï¼š
- ä¸ªäººç”¨æˆ·ï¼šä¸Šä¼ åˆ° GitHub Releases
- ä¼ä¸šç”¨æˆ·ï¼šéƒ¨ç½²åˆ°å†…ç½‘æœåŠ¡å™¨
- å…¬å¼€åˆ†å‘ï¼šä½¿ç”¨ CDN åŠ é€Ÿä¸‹è½½

---

éœ€è¦å¸®åŠ©ï¼Ÿè®¿é—®ï¼šhttps://github.com/MIKUSCAT/nanami-ai-assistant/issues
